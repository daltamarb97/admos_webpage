function _classCallCheck(e,o){if(!(e instanceof o))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,o){for(var n=0;n<o.length;n++){var t=o[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,o,n){return o&&_defineProperties(e.prototype,o),n&&_defineProperties(e,n),e}(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{A09s:function(e,o,n){"use strict";n.d(o,"a",(function(){return i}));var t=n("fXoL"),c=n("I/3d"),a=n("tk/3"),i=function(){var e=function(){function e(o,n){_classCallCheck(this,e),this.db=o,this.http=n}return _createClass(e,[{key:"setTableData",value:function(e,o){var n=this.db.collection("payment_tables").doc(e);return n.collection("rows_data").add(o).then((function(e){n.collection("rows_data").doc(e.id).update({rowId:e.id,manualEmail:!1,pending_to_pay:o.amount_to_pay}).then((function(){n.collection("id_facility").doc(e.id).set({facility:o.facility_number,id:o.legal_id,rowId:e.id})}))}))}},{key:"updateSingleRow",value:function(e,o,n){return this.db.collection("payment_tables/").doc(e).collection("rows_data").doc(o).update(n).then((function(){console.log("updated successfully")}))}},{key:"updatePendingToPay",value:function(e,o,n,t){var c=this;return this.db.collection("payment_tables/").doc(e).collection("rows_data").doc(o).update({pending_to_pay:n}).then((function(){c.updatePaymentRecords(o,t)}))}},{key:"updatePaymentRecords",value:function(e,o){var n=this.db.collection("payments_records").doc(e).collection("record_of_payments");return n.add(o).then((function(e){var o=e.id;n.doc(o).update({paymentId:o}).then((function(){return console.log("payment updated successfully")}))}))}},{key:"sendPrivateMessage",value:function(e){return this.db.collection("privatechat").doc(e.chatId).collection("messages").add(e.messageData)}},{key:"setKeyOfPrivateChat",value:function(e){return this.db.collection("users").doc(e.localUserId).collection("keyChats").doc(e.foreignUserId).set(e.chatData)}},{key:"setNewBuilding",value:function(e,o,n){var t=this,c=this.db.collection("buildings");return c.add(e).then((function(a){var i=a.id;c.doc(i).update({buildingId:i,buildingPassword:t.createRandomBuildingPassword(),paymentLink:"Cuenta Gratuita"}).then((function(){t.createNewAdminUser(o,n,i),t.createDefaultChatRoom(i,e.name,{roomName:"General",roomDescription:"Sala de chat d\xf3nde todos los miembros del edificio estan autom\xe1ticamente"},n)})).then((function(){c.doc("buildingNames").collection("names").add({buildingId:i,name:e.name})}))}))}},{key:"createRandomBuildingPassword",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890*&^%$#@!",o="",n=0;n<10;n++)o+=e.charAt(Math.floor(Math.random()*e.length));return o}},{key:"createNewAdminUser",value:function(e,o,n){var t=this,c=this.db.collection("users").doc(o);return c.set(e).then((function(){c.update({userId:o,isAdmin:!0,buildingId:n}).then((function(){t.db.collection("buildings").doc(n).update({adminId:o})}))})).catch((function(e){console.log(e)}))}},{key:"doormanCreationTrigger",value:function(e,o){var n=this,t=this.db.collection("buildings").doc(e).collection("employees");return t.add(o).then((function(c){var a=c.id;t.doc(a).update({doormanId:a,buildingId:e}).then((function(){n.db.collection("users").doc(a).set({name:o.name,email:o.email,isDoorman:!0,buildingId:e,userId:a}).then((function(){return console.log("doorman created in users node")})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))})).catch((function(e){return console.log(e)}))}},{key:"createDefaultChatRoom",value:function(e,o,n,t){var c=this,a=this.db.collection("chats").doc(e);return a.set({buildingId:e,buildingName:o}).then((function(){a.collection("rooms").add({roomName:n.roomName,roomDescription:n.roomDescription}).then((function(e){var o=e.id;a.collection("rooms").doc(o).update({roomId:o}).then((function(){c.setChatRoomInfoInUser(t,o,n.roomName,n.roomDescription)}))}))}))}},{key:"createChatRoom",value:function(e,o,n,t){var c=this,a=this.db.collection("chats").doc(e);return a.collection("rooms").add({roomName:o.roomName,roomDescription:o.roomDescription}).then((function(e){var i=e.id;a.collection("rooms").doc(i).update({roomId:i}).then((function(){t.forEach((function(e){e.property?a.collection("rooms").doc(i).collection("participants").doc(e.userId).set({userId:e.userId,name:e.name,lastname:e.lastname,property:e.property}).then((function(){c.setChatRoomInfoInUser(e.userId,i,o.roomName,o.roomDescription)})):a.collection("rooms").doc(i).collection("participants").doc(e.userId).set({userId:e.userId,name:e.name,lastname:e.lastname,property:e.job}).then((function(){c.setChatRoomInfoInUser(e.userId,i,o.roomName,o.roomDescription)}))}))})).then((function(){c.setChatRoomInfoInUser(n,i,o.roomName,o.roomDescription)}))}))}},{key:"createPrivateChat",value:function(e,o){var n=this,t=this.db.createId();return this.db.collection("users").doc(e.userId).collection("keyChats").doc(o.userId).set({chatId:t,name:o.name,lastname:o.lastname}).then((function(){n.db.collection("users").doc(o.userId).collection("keyChats").doc(e.userId).set({chatId:t,name:e.name,lastname:e.lastname})}))}},{key:"setChatRoomInfoInUser",value:function(e,o,n,t){this.db.collection("users").doc(e).collection("chatRooms").doc(o).set({roomId:o,roomName:n,roomDescription:t})}},{key:"sendChatMessage",value:function(e,o,n){return this.db.collection("chats").doc(e).collection("rooms").doc(o).collection("messages").add({name:n.name,lastname:n.lastname,message:n.message,timestamp:n.timestamp,userId:n.userId})}},{key:"sendPrivateChatMessage",value:function(e,o){return this.db.collection("privatechat").doc(e).collection("messages").add({name:o.name,lastname:o.lastname,message:o.message,timestamp:o.timestamp,userId:o.userId})}},{key:"createAnnouncement",value:function(e,o){var n=this.db.collection("board").doc(e).collection("announcements");return n.add(o).then((function(e){var o=e.id;n.doc(o).update({announcementId:o}),console.log("creation of announcement done")}))}},{key:"updateAnnouncement",value:function(e,o,n){return this.db.collection("board").doc(e).collection("announcements").doc(o).update(n).then((function(){console.log("announcement updated")})).catch((function(e){console.log("an error happened: "+e)}))}},{key:"addContact",value:function(e){return this.db.collection("buildings").doc(e.buildingId).collection(e.type).add(e.info)}}]),e}();return e.\u0275fac=function(o){return new(o||e)(t.Wb(c.a),t.Wb(a.a))},e.\u0275prov=t.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()},niqc:function(e,o,n){"use strict";n.d(o,"a",(function(){return i}));var t=n("iqUP"),c=n("fXoL"),a=n("I/3d"),i=function(){var e=function(){function e(o){_classCallCheck(this,e),this.db=o}return _createClass(e,[{key:"deleteSingleTableRow",value:function(e,o){return this.db.collection("payment_tables/").doc(e).collection("rows_data").doc(o).delete().then((function(){console.log("removed successfully")}))}},{key:"deletePullRequestPaymentProof",value:function(e){var o=this;t.storage().ref("paymentRecords/"+e.buildingId).child(""+e.rowId).delete().then((function(){return n=o,c=regeneratorRuntime.mark((function o(){var n,t;return regeneratorRuntime.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(n=this.db.collection("payments_records").doc(""+e.rowId).collection("record_of_payments").doc(""+e.paymentId),t=this.db.collection("payment_tables").doc(""+e.buildingId).collection("rows_data").doc(""+e.rowId),!e.action){o.next=7;break}return o.next=4,n.update({pullRequest:!1});case 4:t.get().subscribe((function(o){var n=o.data().pending_to_pay;t.update({pullRequest:!1,pending_to_pay:n-e.paid_amount})})),o.next=13;break;case 7:if(o.t0=!1===e.action,!o.t0){o.next=13;break}return o.next=11,n.delete();case 11:return o.next=13,t.update({pullRequest:!1});case 13:console.log("pullRequest resolved");case 14:case"end":return o.stop()}}),o,this)})),new((t=void 0)||(t=Promise))((function(e,o){function a(e){try{r(c.next(e))}catch(n){o(n)}}function i(e){try{r(c.throw(e))}catch(n){o(n)}}function r(o){var n;o.done?e(o.value):(n=o.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,i)}r((c=c.apply(n,[])).next())}));var n,t,c})).catch((function(e){return console.error("error deleting image: "+e)}))}},{key:"deleteChatRoom",value:function(e,o,n){var t=this;return this.db.collection("chats").doc(e).collection("rooms").doc(o).delete().then((function(){t.deleteChatRoomFromUser(n,o)}))}},{key:"deleteChatRoomFromUser",value:function(e,o){return this.db.collection("users").doc(e).collection("chatRooms").doc(o).delete().then((function(){console.log(" chat removed successfully")}))}},{key:"deleteAnnouncement",value:function(e,o){return this.db.collection("board").doc(e).collection("announcements").doc(o).delete().then((function(){console.log("announcement deleted")})).catch((function(e){console.log("an error happened: "+e)}))}},{key:"disableDoormanAccountFromDB",value:function(e,o){var n=this.db.collection("buildings").doc(e).collection("employees").doc(o),t=this.db.collection("users").doc(o);return n.delete().then((function(){t.update({disabled:!0}).then((function(){console.log("doorman disabled")}))}))}}]),e}();return e.\u0275fac=function(o){return new(o||e)(c.Wb(a.a))},e.\u0275prov=c.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e}()}}]);