(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{A09s:function(e,o,t){"use strict";t.d(o,"a",(function(){return a}));var n=t("fXoL"),c=t("I/3d"),d=t("tk/3");let a=(()=>{class e{constructor(e,o){this.db=e,this.http=o}setTableData(e,o){let t=this.db.collection("payment_tables").doc(e);return t.collection("rows_data").add(o).then(e=>{t.collection("rows_data").doc(e.id).update({rowId:e.id,manualEmail:!1,pending_to_pay:o.amount_to_pay}).then(()=>{t.collection("id_facility").doc(e.id).set({facility:o.facility_number,id:o.legal_id,rowId:e.id})})})}updateSingleRow(e,o,t){return this.db.collection("payment_tables/").doc(e).collection("rows_data").doc(o).update(t).then(()=>{console.log("updated successfully")})}updatePendingToPay(e,o,t,n){return this.db.collection("payment_tables/").doc(e).collection("rows_data").doc(o).update({pending_to_pay:t}).then(()=>{this.updatePaymentRecords(o,n)})}updatePaymentRecords(e,o){let t=this.db.collection("payments_records").doc(e).collection("record_of_payments");return t.add(o).then(e=>{const o=e.id;t.doc(o).update({paymentId:o}).then(()=>console.log("payment updated successfully"))})}sendPrivateMessage(e){return this.db.collection("privatechat").doc(e.chatId).collection("messages").add(e.messageData)}setKeyOfPrivateChat(e){return this.db.collection("users").doc(e.localUserId).collection("keyChats").doc(e.foreignUserId).set(e.chatData)}setNewBuilding(e,o,t){let n=this.db.collection("buildings");return n.add(e).then(c=>{let d=c.id;n.doc(d).update({buildingId:d,buildingPassword:this.createRandomBuildingPassword(),paymentLink:"Cuenta Gratuita"}).then(()=>{this.createNewAdminUser(o,t,d),this.createDefaultChatRoom(d,e.name,{roomName:"General",roomDescription:"Sala de chat d\xf3nde todos los miembros del edificio estan autom\xe1ticamente"},t)}).then(()=>{n.doc("buildingNames").collection("names").add({buildingId:d,name:e.name})})})}createRandomBuildingPassword(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890*&^%$#@!",o="";for(let t=0;t<10;t++)o+=e.charAt(Math.floor(Math.random()*e.length));return o}createNewAdminUser(e,o,t){let n=this.db.collection("users").doc(o);return n.set(e).then(()=>{n.update({userId:o,isAdmin:!0,buildingId:t}).then(()=>{this.db.collection("buildings").doc(t).update({adminId:o})})}).catch(e=>{console.log(e)})}doormanCreationTrigger(e,o){let t=this.db.collection("buildings").doc(e).collection("employees");return t.add(o).then(n=>{const c=n.id;t.doc(c).update({doormanId:c,buildingId:e}).then(()=>{this.db.collection("users").doc(c).set({name:o.name,email:o.email,isDoorman:!0,buildingId:e,userId:c}).then(()=>console.log("doorman created in users node")).catch(e=>console.log(e))}).catch(e=>console.log(e))}).catch(e=>console.log(e))}createDefaultChatRoom(e,o,t,n){let c=this.db.collection("chats").doc(e);return c.set({buildingId:e,buildingName:o}).then(()=>{c.collection("rooms").add({roomName:t.roomName,roomDescription:t.roomDescription}).then(e=>{const o=e.id;c.collection("rooms").doc(o).update({roomId:o}).then(()=>{this.setChatRoomInfoInUser(n,o,t.roomName,t.roomDescription)})})})}createChatRoom(e,o,t,n){let c=this.db.collection("chats").doc(e);return c.collection("rooms").add({roomName:o.roomName,roomDescription:o.roomDescription}).then(e=>{const d=e.id;c.collection("rooms").doc(d).update({roomId:d}).then(()=>{n.forEach(e=>{e.property?c.collection("rooms").doc(d).collection("participants").doc(e.userId).set({userId:e.userId,name:e.name,lastname:e.lastname,property:e.property}).then(()=>{this.setChatRoomInfoInUser(e.userId,d,o.roomName,o.roomDescription)}):c.collection("rooms").doc(d).collection("participants").doc(e.userId).set({userId:e.userId,name:e.name,lastname:e.lastname,property:e.job}).then(()=>{this.setChatRoomInfoInUser(e.userId,d,o.roomName,o.roomDescription)})})}).then(()=>{this.setChatRoomInfoInUser(t,d,o.roomName,o.roomDescription)})})}createPrivateChat(e,o){const t=this.db.createId();return this.db.collection("users").doc(e.userId).collection("keyChats").doc(o.userId).set({chatId:t,name:o.name,lastname:o.lastname}).then(()=>{this.db.collection("users").doc(o.userId).collection("keyChats").doc(e.userId).set({chatId:t,name:e.name,lastname:e.lastname})})}setChatRoomInfoInUser(e,o,t,n){this.db.collection("users").doc(e).collection("chatRooms").doc(o).set({roomId:o,roomName:t,roomDescription:n})}sendChatMessage(e,o,t){return this.db.collection("chats").doc(e).collection("rooms").doc(o).collection("messages").add({name:t.name,lastname:t.lastname,message:t.message,timestamp:t.timestamp,userId:t.userId})}sendPrivateChatMessage(e,o){return this.db.collection("privatechat").doc(e).collection("messages").add({name:o.name,lastname:o.lastname,message:o.message,timestamp:o.timestamp,userId:o.userId})}createAnnouncement(e,o){let t=this.db.collection("board").doc(e).collection("announcements");return t.add(o).then(e=>{const o=e.id;t.doc(o).update({announcementId:o}),console.log("creation of announcement done")})}updateAnnouncement(e,o,t){return this.db.collection("board").doc(e).collection("announcements").doc(o).update(t).then(()=>{console.log("announcement updated")}).catch(e=>{console.log("an error happened: "+e)})}addContact(e){return this.db.collection("buildings").doc(e.buildingId).collection(e.type).add(e.info)}}return e.\u0275fac=function(o){return new(o||e)(n.Wb(c.a),n.Wb(d.a))},e.\u0275prov=n.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()},niqc:function(e,o,t){"use strict";t.d(o,"a",(function(){return a}));var n=t("iqUP"),c=t("fXoL"),d=t("I/3d");let a=(()=>{class e{constructor(e){this.db=e}deleteSingleTableRow(e,o){return this.db.collection("payment_tables/").doc(e).collection("rows_data").doc(o).delete().then(()=>{console.log("removed successfully")})}deletePullRequestPaymentProof(e){n.storage().ref("paymentRecords/"+e.buildingId).child(""+e.rowId).delete().then(()=>{return o=this,void 0,n=function*(){let o=this.db.collection("payments_records").doc(""+e.rowId).collection("record_of_payments").doc(""+e.paymentId),t=this.db.collection("payment_tables").doc(""+e.buildingId).collection("rows_data").doc(""+e.rowId);e.action?(yield o.update({pullRequest:!1}),t.get().subscribe(o=>{const n=o.data().pending_to_pay;t.update({pullRequest:!1,pending_to_pay:n-e.paid_amount})})):!1===e.action&&(yield o.delete(),yield t.update({pullRequest:!1})),console.log("pullRequest resolved")},new((t=void 0)||(t=Promise))((function(e,c){function d(e){try{s(n.next(e))}catch(o){c(o)}}function a(e){try{s(n.throw(e))}catch(o){c(o)}}function s(o){var n;o.done?e(o.value):(n=o.value,n instanceof t?n:new t((function(e){e(n)}))).then(d,a)}s((n=n.apply(o,[])).next())}));var o,t,n}).catch(e=>console.error("error deleting image: "+e))}deleteChatRoom(e,o,t){return this.db.collection("chats").doc(e).collection("rooms").doc(o).delete().then(()=>{this.deleteChatRoomFromUser(t,o)})}deleteChatRoomFromUser(e,o){return this.db.collection("users").doc(e).collection("chatRooms").doc(o).delete().then(()=>{console.log(" chat removed successfully")})}deleteAnnouncement(e,o){return this.db.collection("board").doc(e).collection("announcements").doc(o).delete().then(()=>{console.log("announcement deleted")}).catch(e=>{console.log("an error happened: "+e)})}disableDoormanAccountFromDB(e,o){let t=this.db.collection("buildings").doc(e).collection("employees").doc(o),n=this.db.collection("users").doc(o);return t.delete().then(()=>{n.update({disabled:!0}).then(()=>{console.log("doorman disabled")})})}}return e.\u0275fac=function(o){return new(o||e)(c.Wb(d.a))},e.\u0275prov=c.Ib({token:e,factory:e.\u0275fac,providedIn:"root"}),e})()}}]);